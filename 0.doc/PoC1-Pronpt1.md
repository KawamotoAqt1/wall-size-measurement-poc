あなたは「AIお勧め表札システム」の PoC を実装するエンジニアです。
ブラウザ側は HTML / CSS / JavaScript（生JS）と Canvas、サーバ側は Python + FastAPI を使ってください。
このプロジェクトでは、以下の「寸法測定PoC」をフルスタックで構築してください。

========================
■ 目的・ゴール
========================

門柱の写真から YOLO で検出した「基準物（ポスト・ドアホン・ブロック）」を使って画像のスケールを決め、
ユーザーが画像上にドラッグして作成した四角形（貼り付け位置）の **実寸 W(mm)、H(mm)** を表示できる
ところまでを PoC として実装してください。

今回は「表札の合成」などは不要で、「寸法が測れる」ことが分かるのがゴールです。

========================
■ 前提・制約
========================

- フロントエンド：
  - HTML / CSS / JavaScript（Vanilla JS）で作成する
  - Canvas API を使って画像表示・枠描画を行う
  - シングルページでOK（SPAでなくてよい）
- バックエンド：
  - Python + FastAPI で簡易APIサーバを作る
  - エンドポイント: POST /api/v1/pillar/analyze
  - 画像は multipart/form-data で受け取る
  - 現時点では YOLO の本実装は「モック」でよい
    - 固定のダミー bounding box を返す実装でOK
    - 後から YOLO を差し替えられるように関数分離しておく
- プロジェクトはローカル開発を想定し、できるだけセットアップが簡単な構成にする
- UI 文言は基本的に日本語で表示する

========================
■ フロントエンドの要件
========================

### 1. 画面構成

index.html には以下の要素を配置してください：

1. 画像選択エリア
   - 「画像ファイルを選択」（<input type="file">）
   - 将来カメラ入力を追加できるスペース（ボタンのコメントだけでも可）

2. 「基準物を解析する」ボタン
   - クリックすると画像をサーバへ送信して解析APIを呼ぶ

3. Canvasエリア
   - 門柱画像を表示するキャンバス
   - サーバから返ってきた基準物の枠（bounding box）を描画する
   - 後のステップで、貼り付け位置用の矩形もここに描画

4. 基準物の確認UI
   - テキスト: 「この枠はポスト（またはドアホン等）の位置で正しいですか？」
   - ボタン：
     - 「はい（正しい）」ボタン
     - 「いいえ（枠を修正）」ボタン
   - PoCでは「いいえ」はとりあえずアラート表示 or 未実装でも良い（コメントしておく）

5. 基準物実寸の入力UI
   - ラベル: 「基準物の実寸（mm）を入力してください」
   - 表示する項目例：
     - 基準物種別: ポスト / ドアホン / ブロック（APIの戻り値 type に応じて表示）
     - 幅(mm): input[type=number]
     - 高さ(mm): input[type=number]
   - 初期値は、以下のようなデフォルトマスタから設定：
     - postbox: 幅 340, 高さ 150
     - intercom: 幅 90, 高さ 140
     - block:   幅 390, 高さ 190
   - 「基準寸法を確定」ボタン
     - クリックで「mm_per_px」などのスケール係数を計算して内部状態に保持する

6. 貼り付け位置指定モード
   - 説明テキスト: 「画像の上でドラッグして貼り付け位置を指定してください」
   - 基準寸法確定後にのみ有効になる
   - Canvas上でマウスドラッグ操作を受け取り、ドラッグ開始～終了で矩形を描画する
     - rect_width_px = |x2 - x1|
     - rect_height_px = |y2 - y1|

7. 結果表示エリア
   - 貼り付け位置の実寸を表示：
     - 幅: XXX mm
     - 高さ: YYY mm
     - アスペクト比: W:H（例: 2.5 : 1.0）
   - mmの値は小数第1位程度で四捨五入でOK

### 2. 状態管理

フロント側で簡易な状態管理を行ってください。
状態例:

- state = "idle" | "analyzing" | "confirm_reference" | "set_reference_size" | "select_rect" | "rect_done"

それぞれの状態で有効になるボタンや説明文が変わるように、JavaScriptで制御してください。
（本格的な状態マシンでなくて良いが、コメントで状態遷移が分かるようにする）

### 3. スケール計算ロジック

ユーザーが確定した基準物の幅(mm)と、検出された枠の幅(px)からスケールを計算：

- ref_width_mm: inputから確定した値
- bbox_width_px: API応答の reference_object.width

計算式:

- mm_per_px = ref_width_mm / bbox_width_px

ユーザーがドラッグして選んだ矩形について：

- rect_width_mm  = rect_width_px  * mm_per_px
- rect_height_mm = rect_height_px * mm_per_px

これを結果エリアに表示してください。

========================
■ バックエンドの要件（FastAPI）
========================

- Python + FastAPI で /api/v1/pillar/analyze を実装

### エンドポイント仕様

- メソッド: POST
- パス: /api/v1/pillar/analyze
- 受信:
  - multipart/form-data
  - フィールド名: "pillar_image"
- 返却JSON:

成功例:

```json
{
  "reference_object": {
    "type": "postbox",
    "x": 120,
    "y": 300,
    "width": 200,
    "height": 150,
    "confidence": 0.94
  },
  "pillar_image_width": 1080,
  "pillar_image_height": 1920
}
````

基準物が検出できない例:

```json
{
  "reference_object": null,
  "pillar_image_width": 1080,
  "pillar_image_height": 1920
}
```

### 実装方針

* まずは YOLO 実行部分はダミーでOK

  * 例えば常に中央付近に postbox を返すような関数を定義:

    * def mock_detect_reference_object(image) -> dict:
* 後から YOLO を実装する時に、この関数を差し替えるだけで済むようにしておく
* 画像の幅・高さは Pillow 等で取得して pillar_image_width / height として返す

========================
■ ディレクトリ構成（提案）
==============

シンプルな構成でよいので、例えば以下のようにしてください：

* project_root/

  * backend/

    * main.py           # FastAPI エントリポイント
    * detection.py      # YOLO or モック検出ロジック
    * requirements.txt  # FastAPI, Pillow など
  * frontend/

    * index.html
    * style.css
    * main.js
  * README.md           # 起動方法と簡単な説明

README には以下を記載してください：

* バックエンドのセットアップ方法（venv, pip install -r requirements.txt）
* uvicorn での起動方法
* フロントエンドの起動方法（VSCode Live Server など簡易でOK）
* フロントとバックエンドの URL（例: フロント [http://127.0.0.1:5500](http://127.0.0.1:5500), API [http://127.0.0.1:8000）](http://127.0.0.1:8000）)

========================
■ コーディングスタイル
============

* コードは読みやすさ重視でコメントをしっかり入れる
* 日本語コメントOK（特にフロント側の状態遷移や計算ロジックは丁寧に）
* ファイル内の関数は役割ごとに分ける（例: 描画系関数、状態更新関数、API呼び出し関数など）
* エラー時は最低限 alert や console.error で状況が分かるようにする

========================
■ 最終的な期待アウトプット
==============

* 画像を選び、「基準物を解析する」を押すとダミーの基準物枠が表示される
* ユーザーが基準物の実寸を入力し、「基準寸法を確定」すると内部でスケールが決定される
* ユーザーが画像上をドラッグして四角を描くと、その枠の実寸の幅・高さ(mm)が画面に表示される
* コードをそのままローカルで実行すれば PoC として動作確認できる状態になっている

この要件を満たすコード一式を、Stepごとに提案しながら実装してください。
不足している前提や曖昧な点があれば、まずは前提を仮定してから実装し、その旨コメントに書いてください。

```

---

このプロンプトをそのまま Cursor の「新しいエージェント」や「/chat」側に貼れば、  
PoC 全体を組み立てる方向で動いてくれるはずです。

